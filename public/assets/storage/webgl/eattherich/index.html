<!DOCTYPE html>
<html lang="en-us">
	<head>
		<base href="https://cdn.statically.io/gh/slqntdevss/EatTheRichPort/main/" />
		<meta charset="utf-8" />
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Unity WebGL Player | Eat The Rich</title>
		<script src="Build/UnityLoader.js"></script>
		<script>
			function mergeFiles(fileParts) {
				return new Promise((resolve, reject) => {
					let buffers = [];

					function fetchPart(index) {
						if (index >= fileParts.length) {
							let mergedBlob = new Blob(buffers);
							let mergedFileUrl = URL.createObjectURL(mergedBlob);
							resolve(mergedFileUrl);
							return;
						}
						fetch(fileParts[index])
							.then((response) => response.arrayBuffer())
							.then((data) => {
								buffers.push(data);
								fetchPart(index + 1);
							})
							.catch(reject);
					}
					fetchPart(0);
				});
			}

			function getParts(file, start, end) {
				let parts = [];
				for (let i = start; i <= end; i++) {
					parts.push(file + ".part" + i);
				}
				return parts;
			}

			function resizeUnityContainer() {
				var container = document.getElementById("unityContainer");
				container.style.width = window.innerWidth + "px";
				container.style.height = window.innerHeight + "px";
			}
			Promise.all([
				mergeFiles(getParts("Build/EatTheRichPort.data.unityweb", 1, 3)),
			]).then(([dataUrl]) => {
				window.dataUrll = dataUrl;
				var json = {
					companyName: "DefaultCompany",
					productName: "Eat The Rich",
					dataUrl: "EatTheRichPort.data.unityweb",
					wasmCodeUrl: "EatTheRichPort.wasm.code.unityweb",
					wasmFrameworkUrl: "EatTheRichPort.wasm.framework.unityweb",
					wasmSymbolsUrl: "EatTheRichPort.wasm.symbols.unityweb",
					TOTAL_MEMORY: 67108864,
					graphicsAPI: ["WebGL 2.0", "WebGL 1.0"],
					webglContextAttributes: { preserveDrawingBuffer: false },
					splashScreenStyle: "Dark",
					backgroundColor: "#231F20",
				};
				let blob = new Blob([JSON.stringify(json)], {
					type: "application/json",
				});
				let blobUrl = URL.createObjectURL(blob);
				window.addEventListener("resize", resizeUnityContainer);
				UnityLoader.instantiate("unityContainer", json, {
					url: blobUrl,
					Module: {
						onRuntimeInitialized: function () {
							resizeUnityContainer();
							document.querySelector("#loading-text").remove();
						},
					},
				});
			});
		</script>
	</head>
	<body>
		<div
			id="gameContainer"
			style="width: 960px; height: 600px; margin: auto"
		></div>
	</body>
</html>
